---
author: Hugo Authors
title: 网络基础应用知识
date: 2023-11-25
description:  网络基础知识
series: 
  - 网络安全基础

---

在了解网络安全这门课程的时候我们还需要了解一下网络这门学科的基础知识，自己有将自己的基础打牢古才能将上层建筑建设的稳。

<!--more-->
# 简述IP地址

## 作用 
  用来标识一个网络节点的互联网地址，有IPv4和IPv6两个版本
  - IPv4地址：互联网协议地址
    - 作用：标识一个节点的网络位置
    - 长度： 32个二进制位
    - 组成：网络位+主机位
    - 表示方式：点分十进制
    - 数量：2的32次方

## 分类 
  IPv4地址一共分为五类
  -  A类---0~127
  -  B类---128~191
  -  c类---192~223
  -  D类---223~239-----组播地址
  -  E类---240~255-----科研地址

## 公有地址和私有地址
  -  公有地址 互联网上的合法地址，这些地址你需要向一些运营商缴纳费用申请，手机可以直接上网通信的，全球唯一。
  -  私有地址 这些地址是预留在企业内部使用的，无需缴费，每个人或者公司都能是使用，主要是解决IP地址不足的问题。这个地址在局域网中唯一，但是私有地址有范围的控制（在ABC三大类中各有若干IP地址给私有地址）
  - 私有地址有私有地址的范围：
    - A类 10.0.0.0~10.255.255.255----有效主机地址----10.0.0.1~10.255.255.254
    - B类 172.16.0.0~172.31.255.255----有效主机地址----172.16.0.0.1~172.31.255.254
    - C类 192.168.0.0~192.168.255.255----有效主机地址----192.168.0.1~192.168.255.254
  
## 子网掩码
  - 作用：区分IP地址中的网络位和主机位，它也是由32位二进制组成
  - 子网掩码可以分为两类：
    - 默认子网掩码（只存在于ABC三类）
      - A类：255.0.0.0
      - B类：255.255.0.0
      - C类：255.255.255.0
    - 自己定义的子网掩码
      - 32位IP地址中网络位为1，主机位为0，主机位除去首尾剩下的就是可以留存的主机数量，首代表着这个网络段，尾代表着这个网络的广播地址。
## 网关
从当前网段前往其他网段的出口（相同网段通信不需要网关）

# 网络通信原理

## OSI七层模型和TCP/IP五层模型
OSI七层模型中的上三层相当于TCP/IP五层模型中的第一层其他的都是一一对应

而对于TCP/IP五层模型中在数据包装格式中，每一层都有自己的PDU（`协议数据单元即协议的数据包`）
```
OSI七层模型               TCP/IP五层模型           对应的PDU     数据的封装过程
  应用层
  表示层
  会话层                  应用层                  数据                                         |数据|
  传输层                  传输层                  数据段                             |TCP头部|数据|
  网络层                  网络层                  数据包                     |IP头部|TCP头部|数据|
  数据链路层            数据链路层             数据帧        |MAC头部|IP头部|TCP头部|数据|尾部|
  物理层                  物理层                  比特流
```
## AAA
AAA是网络安全中进行访问控制的一种安全管理机制，提供认证、授权和计费三种安全服务

# 弹性交换网络

## 冲突域和广播域
- 冲突域：就是连接在同一导线上的所有工作站集合
- 广播域：网络中能接收任意设备发出的广播帧的所有设备的集合
- 区别：
  - 交换机每一个接口都是一个冲突域
  - 路由器每个接口都是一个广播域

## 交换机的工作原理
学习——>广播——>转发——>更新

## 路由器的工作原理
路由器是根据路由表来转发数据包的，当一个路由器接收到一个数据包的时候，会查找路由表中是否存在这个数据包的目的地址。如果存在，就按照此路由链路下一跳的地址进行转发，如果不存在则丢弃这个数据包。

## VLAN
- VLAN：虚拟局域网
- 作用：分割广播域
- 优势
  - 限制广播域，节省带宽资源
  - 增强局域网安全性
  - 提高网络的健壮性
  - 灵活的构建局域网
- 划分方式
  - 基于接口的划分（主要划分方式）
  - 基于MAC的划分
  - 基于子网的划分
  - 基于协议的划分
- 端口类型（华为）
  - Access接口：一般用于链接终端
    - Access链路一般用于交换机连接终端，同一时刻只能同一VLAN间相互通信，发送数据的时候会剥离VLAN标签
  - Trunk接口：一般用于链接交换机、路由器
    - Trunk链路一般用于交换机连接交换机，同一时刻可以支持多个VLAN的数据转发，发送数据的时候携带VLAN标签
  - Hybrid：既可以连接终端，也可以连接网络设备

## 链路聚合Eth-Trunk的作用
  
  Eth-Trunk作为一种捆绑技术，可以把多个独立的物理接口绑定在一起作为一个大的逻辑接口来使用。优点：可以增加设备之间的互联贷款，提高设备的可靠性，对流量负载均衡，提高线路利用率
  
  链路聚合分为两类（手工链路和LACP链路）
  - 特点：
    - 手工链路：当两台设备中至少有一台不支持LACP协议时，可以使用手工负载分担模式的Eth-Trunk。在手工负载分担的模式下，加入Eth-Trunk的连路都进行数据转发。
    - LACP链路：LACP模式也称为M:N模式，其中M条链路处于活动状态，N条链路处于非活动状态作为备份
  - 区别：
    - 手工链路：不需要支持LACP协议、正常情况下，所有链路都是活动链路、无法检测链路错连。
    - LACP链路：需要支持LACP协议、正常情况下部分链路是活动链路、可以检测链路错连
  - 系统默认的LACP的优先级
    - 默认优先级是32768 ，提供了一种通过vlan进行网络资源控制的机制，通过MUX VLAN 提供的二层流量隔离机制。可以实现企业内部员工之间相互通信，而企业外来访客之间是互相隔离的。

# 路由
## 动态路由
IGP：内部网关路由协议-在同一个AS内部使用（在企业内部或者数据中心内部使用）
  - DV：距离矢量路由协议
    - RIP（v1/v2）
    - IGRP-思科私有协议
    - EIGRP-思科私有协议
  - LS：链路状态路由协议
    - OSPF：开放式最短路径优先（企业用：功能多，可以精细化控制）
    - ISIS：中间系统到中间系统（数据中心用，转发能力强，大流量转发）
  - EGP：外部网关路由协议：在不同的AS之间使用（AS：自治系统）
    - BGP：边界网关协议

特点：
- 自动计算路由，无需手动配置
- 网络拓扑变更时候，自动更新路由，不用手动配置
- 支持负载均衡，提高网络可靠性
- 选择最优路径
### OSPF路由
#### OSPF：开放式最短路径优先。协议号：89
  - 开放式：公有协议，所有厂商都支持
  - 最短路径优先：以最短路径，最快方式转发数据包
  - 作用：动态感知全网状态，自动计算路由
  - 应用：通常用于企业内部，和数据中心内部
  - 工作在OSI模型中的第三层，数据封装在IP头部后面
  - OSPF是基于链路状态的内部网关协议
#### 优势：
  - 利用`累计cost值`来计算最优路径
  - 采用组播形式收发协议报文，提高效率
  - 用区域的概念，降低设备压力，更加利于管理
  - 支持等价路由负载分担，提高可靠性
  - 支持报文认证，提高安全性
#### 基础概念
  - 在同一区域内的所有ospf路由器，数据库是完全一样的
  - Router ID
    唯一，在OSPF网络中标识一台路由器的唯一标识
    - 特点：稳定，一旦确定，就不会改变，要更改只能重启OSPF进程
    - OSPF协议为路由设备起的名字
    - Router ID可以手动指定，也可以自动选举
    - 如果没有手动配置，则路由器使用Loopback接口中最大的IP地址作为Router ID
    - 如果没配置接口，则路由器使用物理接口中最大的IP地址作为Router ID
  - area ID
    将路由设备划分成不同的组，每个组用区域号标识
    - 区域号
      
      用于标识一个网络区域，通过这样来缩减路由规模，降低路由设备分担。
      - 骨干区域：0
      - 非骨干区域：不为0
      - 区域号表示：
        - 十进制
        - 点分十进制
  - cost：开销
    
    OSPF路径会累积cost值来计算最短路径
    - 每一个开启OSPF功能的物理接口都有一个cost值为1

  - DR和BDR、DRother

    这是一个接口的概念，不是路由器的概念，他是建立邻居的时候才会选举的
    - DR（指定路由器）BDR（备份指定路由器）DRother（其他路由器）
    - DRother之间建立to-way（邻居）关系，但他和DR/BDR建立Full（邻接）关系
    - 作用：减少邻接关系，加快数据库同步
    - 选举规则：
      - 选举是非抢占式的
      - 选举是基于接口的
    - 优先级越高越优先，当优先级为0是则这个接口一定是DRother

#### 工作原理
  - 建立OSPF邻居表--hello
  - 同步OSPF数据库--LSA
  - 计算OSPF路由表
#### 五种报文 七大状态
  - Hello 报文：用于发现、建立、维护和拆除OSPF邻居

    第一个Hello报文用来建立邻居，后续Hello报文用于同步数据库
    - down：挂掉了，表示给hide设备之间的邻居状态最新的开始
    - init：初始化状态，收到对端的Hello报文，进入Init状态，但此时的Hello报文不包含自己的Router ID
    - two-way：
      - 双向通信状态，收到的Hello报文中包含自己的Router ID，则状态为two-way此时两台设备之间为邻居状态
      - 在广播网络里，我们会选举DR/BDR（DR/BDR没有抢占）
    - 在这个状态下，我发送的Hello报文对端收到了
    - 对端发送的Hello报文，我也收到了
  - DD：数据库描述报文
  
    用于发送OSPF数据库数据库条目（LSA头部信息）的简要信息，实现数据库同步

    - ExStart状态
      - 交换初始化状态。在该阶段，交互第一个DD报文，为了保证后期交换状态的稳定和可靠，所以该阶段会进行邻居路由器之间主从关系的确定
    - Exchange状态
      - 交换状态，交互的是大量的DD报文，我们称之为LSA头部信息

  - LSR：链路状态请求报文

    用于请求自己数据库中没有的链路状态通告信息
    - Loading状态
      - 加载状态，两边通过了交换，完成了数据库的比较，那么就会在该阶段进行加载，会对自己没有的那些数据库条目进行请求lsr，对方设备回应更新LSU包含完整的LSA，为了确保可靠传输，在双方设备收到后，会给对方回应一个LSACK报文，双发设备都经过了上面的三个报文之后，实现数据库的完全相同，就会进入到下一个状态。
  - LSU：链路状态更新报文

    用于回应LSR报文，发送链路状态信息。
    - Loading状态：同上
  - LSACK

    确认LSU和LSR报文
    - Loading状态：同上
  - 全部完成后是full状态
    - 完全邻接状态，表示两个设备的数据库完全相同


  
#### LSA
  
  - OSPF路由怎么来的
    
    靠LSA计算出来的
    - LSA怎么来的：通过数据库同步，从邻居那里学来的。
    - 而且LSA非常重要，我们要保证传递的可靠性和有序性。
  - 如何保证：
    - 选举主从：Master/Slave，作用：保证数据库同步的有序性准确性
    - 利用router-id来选举，大的为Master
    - 选举完成后小弟永远使用大哥序列号，大哥序列号永远加1
    - 下一个报文是对上一个报文的确定（例:LSU给LSR，Lsack给LSU）

    这样传递的目的是为了，让DD报文更有序，可靠不丢失
- LSA
  - 作用：用来计算路由的
  - 如何形成的：
    - network
    - import-router：五类LSA

LSA（链路状态通告）七个字段，通常用其中3个字段来区分不同的LSA
  - 类型，名字，通告路由

##### 五类LSA
  - 一类LSA

    - 类型（Type）： Router-LSA
    - 名字（LinkState ID）：1类LSA的名字取自-生产这条LSA的路由器的Router-id
    - 通告路由器：(AdvRouter)：区域内每一台路由器都会产生一个1类LSA
    - 特点：每一个运行OSPF协议的路由器，都会在这台路由器所处的区域中生成一个1类的LSA
    - 传递范围：只能在区域内传递
    - 作用：用来计算域内路由（做自我介绍）
          自我介绍，介绍什么内容：
          介绍两个内容：拓扑信息+网段信息
          拓扑信息：我是谁，我的邻居是谁，我用那个接口IP连接着我的邻居
          网段信息：我的接口网段，我接口网段的掩码，我的接口的cost开销值
 
 - 点到点

    LSA的头部信息：
    ```
    Type ：Router ：我是一类IP
    Ls id ：1.1.1.1：我的名字是1.1.1.1
    Adv rtr ：1.1.1.1：我的老爹是1.1.1.1（通告路由其-创造这条LSA的设备）
    Ls age ：372：我的年龄是372秒
    Len ：60：我的长度为60字节
    Options ：E：我的能力：引入外部路由
    seq# ：8000001f：我的序列号：
                    LSA的寿命是3600秒
                    1800秒就刷新一次，没刷新一次序列号加1
                    这叫周期性更新，还有触发式更新
                     序列号越大，代表LSA越新
    chksum ：0x4a9：我的校验和（序列号相同的情况下，校验和越大LSA越新）
    ```  
  - LSA链路信息
    ```
      Link count: 3                    我有3条链路（LSA表示了两种信息，拓扑信息和网段信息）
      Link ID: 2.2.2.2              我是邻居的名字
      Data   : 192.168.12.1      我的接口IP地址是192.168.12.1（我用这个IP连接我的邻居）
      Link Type: P-2-P           这是描述的拓扑信息  
      Metric : 1                      我的cost值是1

      Link ID: 192.168.12.0      我的接口的IP地址段是192.168.12.0
      Data   : 255.255.255.0     我的接口的IP地址段的掩码是24
      Link Type: StubNet         这是描述的网段信息
      Metric : 1                       我的cost值是1
      Priority : Low

      Link ID: 192.168.1.0       我的接口IP地址段是192.168.1.0
      Data   : 255.255.255.0     我的接口IP地址段的掩码是24
      Link Type: StubNet         这是描述的网段信息
      Metric : 1                        我的cost值是1
      Priority : Low

    ```

  - 二类LSA
    - 类别：network-LSA
    - 名字：2类LSA的名字取自，DR的接口IP地址
    - 通告路由器：DR接口所在的那台路由器的Router-id
    - 作用：
      - 补全DR接口IP地址的掩码信息。
      - 记录和DR建立邻接关系的路由器，用于描述网段内完整拓扑信息
      - 最终作用：辅助1类LSA完成区域内路由的计算
  
  - 一类和二类LSA的作用：计算域内路由
    - 传播范围：只能在区域内传播
  
  - 三类LSA
    - 类别：Network-summary-LSA
    - 名字：3类LSA的名字取自区域间路由网段的名字
    - 通告路由器：本区中的ABR路由器的Router-id
    - 传递范围：3类的LSA仅仅在区域内传播
    - 作用：
      - 计算域间路由 
      - 将区域内的1、2LSA计算出来的路由，变成3类LSA在其他区域泛洪（广播），实现区域与区域之间的通信
    - 总结：
      - 3类LSA在传递过程中，每经过一个ABR它的名字就会发生变化。
    - 三类LSA头部信息   
    ```
      Type      : Sum-Net           我是三类LSA
      Ls id     : 192.168.45.0      我的名字是192.168.45.0
      Adv rtr   : 2.2.2.2           我是从2.2.2.2那里学来的
      Ls age    : 969 
      Len       : 28 
      Options   :  E  
      seq#      : 80000006 
      chksum    : 0xa016
      Net mask  : 255.255.255.0     下一跳的掩码
      Tos 0  metric: 3              所 用消耗
      Priority  : Low
    ```
  - 四类LSA

    就是带你去找ASBR的
    - 类别：ASBR-summary -LSA 
    - 名字：取自asbr的router-id
    - 通告路由其：本区域的ABR设备
      - 第一个四类LSA是由和ASBR在同一个区域内的那个ABR产生的
      - 后续的4类LSA，是由本区域的ABR产生的
    - 传播范围：在一个区域内传播
    - 特点：4类LSA在传播过程中，每经过一个ABR，通过路由器就会变成所经过的那台ABR的router-id
    - 作用： 
      - 配合5类LSA计算外部路由
      - 将5类LSA传递到其他路由器中
    - 带你去找ASBR
  - 五类LSA

    带你去往外部网段，但是去找外部网段，就需要先找到ASBR
    - 类别：AS_external-LSA
    - 名字：外部路由网段的名字
    - 通告路由器：ASBR的router-id
    - 作用：计算外部路由
    - 传递范围：在整个ospf网络内传播
    - 特点：
      - 只有ASBR可用产生5类的LSA
      - 5类的LSA可用传输到ospf网络的所有的路由器（特殊区域除外）
      - 5类LSA在传输过程中，不会产生任何变化
      - 5类LSA不属于任何区域
      - 他想去哪里就去哪里
    - 查询命令：
      ```
      display ospf lsdb ase
      display ospf lsdb ase 192.168.3.0
      ```
  - 四类和五类LSA的作用：用于计算外部路由
#### OSPF特殊区域（保护这个区域不受外部路由器的影响）
  - stub区域
    - 末梢区域：网络的边缘末梢，脆弱的需要保护的区域（）
    - 保护这个区域
      - 不学习四类五类LSA
    - 该区域会产生一个默认路由的5类LSA，保证和外部的通信
  - totally stub区域
    - 完全的末梢区域
    - 不要三四五类LSA
# 协议
## MAC地址
MAC地址也叫物理地址，由48位二进制组成，前二十四位表示的是厂商标识，后二十四位表示的是厂商自己分配的编号，在前二十四位中第八位为0则表示单播地址，第八位为1则表示组播地址，如果MAC地址全部为0，则表示这是一个待填充的地址，全部为1则表示这是一个广播地址。

## DNS协议
- DNS即Domain Name System，域名系统
- 端口号：53
- 主要作用：DNS服务器可以为客户端提供“IP地址和域名”的地址解析服务

## ARP协议
- ARP即Address Resolution Protocol，地址解析协议
- 主要作用：基于已知的目标IP地址解析出对应目标的MAC地址
- 分类：
  - 普通ARP（正向ARP）：通过IP地址解析MAC地址
  - 反向ARP（RARP）：通过MAC地址解析IP地址
  - 免费ARP：查询想使用的IP地址是否在局域网内被占用
  - 逆向ARP（IARP）：通过物理地址获取IP地址（一般出现在帧中继网络中，实现IP和DLCI地址映射）
  - 代理ARP：路由器收到ARP request 时，发现源IP和目标IP不在同一网段，就会当代理ARP角色，作为回答，告诉查询者它想要的MAC地址。
- 发送ARP请求报文时，目的MAC字段为全0的MAC地址0x0000-0000-0000（在前面的MAC地址中我说过全为0的MAC地址指的是待填充的MAC地址）
- 静态ARP
  - 手工建立的IP地址和MAC地址之间的固定映射关系就是指静态ARP
  - 配置方法： 
  ```
  arp -s 主机地址 mac地址   
  arp -s 192.168.222.4 00-50-56-ff-17-93
  ```

## ICMP协议
- ICMP即Internet Control Message Protocol，控制消息协议，协议号1，位于TCP/IP的第三层。
- 作用：检测网络通信故障，实现链路追踪。
- ICMP协议中两大应用：
  - ping命令： 检查网络是否畅通的常用命令
  - tracert命令：用于检查IP数据包访问目标所采取的路径
- ICMP的常见回显消息
  - Reply from------------------------目标地址······连接成功
  - Destination host unreachable------目标主机不可达
  - Request timed out ----------------请求时间超时
  - Unknow host ……--------------------未知主机名

## TCP协议
- TCP即Transmission Control Protocol传输控制协议
- 作用：是一种面向连接的、可靠的传输层通信协议
- TCP的可靠依据：
  - 三次握手
    - 第一次握手：建立连接时，客户端发送syn包（seq=j）到服务器。
    - 第二次握手：服务器收到syn包，必须确认客户端的SYN（ack=j+1），同时自己也发送一个SYN包（seq=k）即SYN+ACK包
    - 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK（ack=k+1），此包发送完毕，客户端和服务器TCP连接成功
  - 四次挥手
    - 第一次挥手：数据传输完毕后需要断开连接，客户端发送fin包（seq=u）到服务器。
    - 第二次挥手：服务器收到fin包即刻向客户端发送ack包（ack=u+1，seq=v）
    - 第三次挥手：服务器再发送完上个包后随后紧接着发送一个fin包（seq=w，ack=u+1）服务器进入最后确认状态
    - 第四次挥手：客户端在接到服务器发送的报文后发出确认包文（seq=u+1，ack=w+1）随后服务器等待2MSL后（最大报文生存时间）进入close状态。

## UDP协议
- UDP即User Datagram Protocol 用户数据报协议
- 非连接的协议、不可靠的传输层协议

## Telnet协议
- Telnet：远程终端协议
- 端口号：TCP 23

## FTP和TFTP协议
- FTP文件传输协议
- TFTP简单文件传输协议
- 区别：
  1. 标准FTP端口号：TCP 20和21。标准TFTP端口号UDP 69.
  2. FTP用于稳定的传输大容量文件，TFTP用来传输一些小的文件，速度虽然快但很容易丢包。


## STP协议
- STP协议有三类
  - STP：生成树协议
  - RSTP：快速生成树协议
  - MSTP：多生成树协议
- STP的作用
  - 防止数据转发环路的出现。
- 优先级
  - 桥的默认优先级是：32768 步长：4096
  - 端口的默认优先级是128
- 工作原理
  
  默认情况下，交换机的STP协议是自动开启的，通过与其他交换机互相发送消息比较BPDU（协议中BPDU分为两类：配置BPDU和拓扑变更BPDU），从而确保网络中去往任何设备仅存在一条最短的，无环，2层转发路径。
  - 首先确定交换机的角色（根交换机和非根交换机）
  - 其次确定端口的角色（根端口，指定端口和非指定端口）
  - 最后确定端口的状态（down、listening、learning、forwarding、blocking）
- 选举规则
  - 交换机选举规则
    - 通过比较每个交换机BID（桥ID）的值来确定
    - 首先比较其中的优先级，值越小越优先
    - 如果优先级相同，通过比较MAC地址来确定，一样是值越小越好
  - 根端口的选举规则 
    - 在非根交换机上，有且仅有一个，看接口到根交换机的路径成本。
    - 非根交换机上到根交换机花费最小的端口就是根端口
    - 当到根交换机的cost值相同时，比较发送者的BID（桥ID-8字节：桥优先级-2字节+桥MAC-6字节）
    - 当这两个值都相同时，比较发送者PID（端口ID-16位=端口优先级-4位+端口号-12位）
    - 当发送者的PID也相同时，比较接收者的PID
  - 指定端口的选举规则
    - 作用：专门用来发送BPDU报文（发送根桥指令的）
    - 规则：
      - 比较到根交换机最小的cost值
      - cost值相同时，两台交换机相互比较BID，PID
    - 定律
      - 根网桥（根交换机）上的所有端口都是指定端口
      - 一根网线上一端是根端口另一端一定是指定端口
      - 每个端口都承担一个角色
      - 同一条链路上有且仅有一个指定端口
  - MSTP和RSTP对比，有什么优势？

    MSTP（多生成树协议）：继承了RSTP（快速生成树）的优点，并且引入了实例的概念，实现基于实例的负载均衡。不但可以实现多链路之间的备份，还可以提高多个链路的利用率。

